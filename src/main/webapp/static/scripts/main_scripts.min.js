function showAlertWarning(e){bootstrap_alert.warning(e),window.scrollTo(0,0)}function showAlertDanger(e){bootstrap_alert.danger(e),window.scrollTo(0,0)}function editToSaveButton(e,t,n,i){const a=document.createElement("input");a.setAttribute("type","button"),a.setAttribute("id",e),a.setAttribute("class","button-primary-m rounded edit-button"),a.setAttribute("value","Salva"),a.setAttribute("onclick",i);const d=document.getElementById(t),o=document.getElementById(n);d.replaceChild(a,o)}function addDeleteButton(e,t,n,i,a){const d=document.createElement("input");d.setAttribute("type","button"),d.setAttribute("id",t),d.setAttribute("class","button-tertiary-m rounded edit-button"),d.setAttribute("value",e),d.setAttribute("onclick",a);const o=document.getElementById(n),s=document.getElementById(i);o.insertBefore(d,s)}function validateMedicineData(e){let t=!0;return medicineNameValidity(e.name)?document.getElementById("name-validity").innerHTML="":(document.getElementById("name-validity").innerHTML="Formato errato",t=!1),ingredientsValidity(e.ingredients)?document.getElementById("ingredients-validity").innerHTML="":(document.getElementById("ingredients-validity").innerHTML="Formato errato",t=!1),t}function validatePackageData(e,t){let n=!0;return capacityValidity(e.capacity)?document.getElementById("package-"+t+"-capacity-validity").innerHTML="":(document.getElementById("package-"+t+"-capacity-validity").innerHTML="Formato errato",n=!1),dateValidity(e.expiryDate)?document.getElementById("package-"+t+"-expiry-date-validity").innerHTML="":(document.getElementById("package-"+t+"-expiry-date-validity").innerHTML="Formato errato",n=!1),n}function findAllMedicines(e){var t=new XMLHttpRequest;t.open("POST","MedicineServlet",!1),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),t.setRequestHeader("Authorization","Basic "),t.setRequestHeader("Accept","application/json");if(t.send("action=findAllMedicines"),200===t.status){if(t.getResponseHeader("OPERATION_RESULT")){const a=t.getResponseHeader("medicineNumber");var n=[],i=[];for(let e=0;e<a;e++)n[e]=t.getResponseHeader("medicineId"+e),i[e]=t.getResponseHeader("medicineName"+e);const d=document.createElement("option");d.setAttribute("value","null"),d.innerHTML="Seleziona medicinale",e.appendChild(d);for(let t=0;t<a;t++){const a=document.createElement("option");a.setAttribute("value",n[t]),a.innerHTML=i[t],e.appendChild(a)}return e}return null}}function addPackageForm(){document.getElementById("new-package-button").className="hidden",document.getElementById("new-package-form").className="box"}function editMedicineButton(e){editToSaveButton("save-medicine-button","medicine-data-buttons","edit-medicine-data-button","submitUpdatedMedicine('"+e+" ')"),document.getElementById("name").className="input-field",document.getElementById("ingredients").className="input-field"}function editPackageButton(e){editToSaveButton("save-package-button","package-data-buttons","edit-package-data-button","submitUpdatedPackage('"+e+" ')"),document.getElementById(e+"-package-capacity").className="input-field",document.getElementById(e+"-package-expiry-date").className="input-field",document.getElementById(e+"-package-status").className="input-field"}function addMedicine(){const e={name:document.getElementById("name").value,ingredients:document.getElementById("ingredients").value};if(validateMedicineData(e)){var t=new XMLHttpRequest;t.open("POST","MedicineServlet",!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),t.setRequestHeader("Authorization","Basic "),t.setRequestHeader("Accept","application/json");var n="action=insertMedicine&name="+e.name+"&ingredients="+e.ingredients;t.send(n),t.onreadystatechange=function(){if(4===t.readyState&&200===t.status)if(t.getResponseHeader("OPERATION_RESULT")){redirectToMedicineDetails(t.getResponseHeader("MEDICINE_ID"))}else showAlertDanger(t.getResponseHeader("ERROR_MESSAGE"))}}}function addPackage(e){const t={capacity:document.getElementById("package-new-capacity").value,expiryDate:document.getElementById("package-new-expiry-date").value};if(validatePackageData(t,"new")){var n=new XMLHttpRequest;n.open("POST","MedicineServlet",!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),n.setRequestHeader("Authorization","Basic "),n.setRequestHeader("Accept","application/json");var i="action=insertPackage&medicineId="+e+"&capacity="+t.capacity+"&expiryDate="+t.expiryDate;n.send(i),n.onreadystatechange=function(){4===n.readyState&&200===n.status&&(n.getResponseHeader("OPERATION_RESULT")?redirectToMedicineDetails(e):showAlertDanger(n.getResponseHeader("ERROR_MESSAGE")))}}}function redirectToMedicineDetails(e){window.location.replace("MedicineServlet?id="+e)}bootstrap_alert=function(){},bootstrap_alert.warning=function(e){$("#alert-box").html('<div class="alert alert-warning"><span>'+e+"</span></div>")},bootstrap_alert.danger=function(e){$("#alert-box").html('<div class="alert alert-danger"><span>'+e+"</span></div>")};let searchTimeout=null;function fetchMedicineSuggestions(e,t){if(t||(t="medicine-suggestions"),searchTimeout&&clearTimeout(searchTimeout),!e||e.trim().length<2){const e=document.getElementById(t);e&&(e.innerHTML="")}else searchTimeout=setTimeout((()=>{fetch("MedicineServlet?action=autocompleteMedicine&q="+encodeURIComponent(e.trim())).then((e=>e.json())).then((e=>{const n=document.getElementById(t);n&&(n.innerHTML="",e.forEach((e=>{const t=document.createElement("option");t.value=e,n.appendChild(t)})))})).catch((e=>console.error("Errore autocomplete",e)))}),300)}function validatePatientData(e){let t=!0;return namesValidity(e.name)?document.getElementById("name-validity").innerHTML="":(document.getElementById("name-validity").innerHTML="Formato errato",t=!1),namesValidity(e.surname)?document.getElementById("surname-validity").innerHTML="":(document.getElementById("surname-validity").innerHTML="Formato errato",t=!1),dateValidity(e.birthDate)?document.getElementById("birthdate-validity").innerHTML="":(document.getElementById("birthdate-validity").innerHTML="Formato errato",t=!1),cityValidity(e.city)?document.getElementById("city-validity").innerHTML="":(document.getElementById("city-validity").innerHTML="Formato errato",t=!1),taxCodeValidity(e.taxCode)?document.getElementById("tax-code-validity").innerHTML="":(document.getElementById("tax-code-validity").innerHTML="Formato errato",t=!1),phoneNumberValidity(e.phoneNumber)?document.getElementById("phone-number-validity").innerHTML="":(document.getElementById("phone-number-validity").innerHTML="Formato errato",t=!1),notesValidity(e.notes)?document.getElementById("notes-validity").innerHTML="":(document.getElementById("notes-validity").innerHTML="Formato errato",t=!1),t}function validateTherapyData(e){var t=!0;conditionValidity(e.condition)?document.getElementById("condition-validity").innerHTML="":(document.getElementById("condition-validity").innerHTML="Formato errato",t=!1),sessionsValidity(e.sessions)?document.getElementById("sessions-validity").innerHTML="":(document.getElementById("sessions-validity").innerHTML="Formato errato",t=!1),frequencyValidity(e.frequency)?document.getElementById("frequency-validity").innerHTML="":(document.getElementById("frequency-validity").innerHTML="Formato errato",t=!1),durationValidity(e.duration)?document.getElementById("duration-validity").innerHTML="":(document.getElementById("duration-validity").innerHTML="Formato errato",t=!1);for(let n=0;n<e.medicinesNumber;n++)console.log("Medicinale inserito: "+e.medicines[n].id),e.medicines[n].id&&0!==e.medicines[n].id.trim().length?document.getElementById("medicine-"+n+"-validity").innerHTML="":(document.getElementById("medicine-"+n+"-validity").innerHTML="Inserire un medicinale",t=!1),console.log("Dose medicinale: "+e.medicines[n].dose),doseValidity(e.medicines[n].dose)?document.getElementById("dose-"+n+"-validity").innerHTML="":(document.getElementById("dose-"+n+"-validity").innerHTML="Formato errato",t=!1);return t}function addTherapyForm(){document.getElementById("new-therapy-button").className="hidden",document.getElementById("new-therapy-form").className="box form"}async function addMedicineField(e,t){const n=document.createElement("div");n.setAttribute("id",e+"-medicine-item-"+t),n.setAttribute("class","input-fields-row");const i=document.createElement("div");i.setAttribute("class","field left");const a=document.createElement("label");a.setAttribute("for","medicine-name-item-"+t);let d=t+1;a.innerHTML=d+"Â° Medicinale";var o=document.createElement("input");o.setAttribute("type","text"),o.setAttribute("id","search-patient-medicine-"+e+"-"+t),o.setAttribute("class","input-field"),o.setAttribute("name","medicineName"+t),o.setAttribute("placeholder","Cerca farmaco..."),o.setAttribute("autocomplete","off");var s="medicine-suggestions-"+e+"-"+t;o.setAttribute("list",s),o.setAttribute("oninput","fetchMedicineSuggestions(this.value, '"+s+"')");var r=document.createElement("datalist");r.setAttribute("id",s);const c=document.createElement("p");c.setAttribute("id","medicine-"+t+"-validity"),c.setAttribute("class","validity-paragraph status-unavailable"),i.appendChild(a),i.appendChild(o),i.appendChild(r),i.appendChild(c);const l=document.createElement("div");l.setAttribute("class","field right");const u=document.createElement("label");u.setAttribute("for","medicine-dose-item-"+t),u.innerHTML="Dose (in ml)";const m=document.createElement("input");m.setAttribute("id","medicine-dose-item-"+t),m.setAttribute("class","input-field"),m.setAttribute("type","text"),m.setAttribute("name","medicineDose"+t);const p=document.createElement("p");p.setAttribute("id","dose-"+t+"-validity"),p.setAttribute("class","validity-paragraph status-unavailable"),l.appendChild(u),l.appendChild(m),l.appendChild(p),n.appendChild(i),n.appendChild(l),document.getElementById(e+"-medicines").appendChild(n),document.getElementById("medicines-number").innerHTML=d;var y="add-medicine-"+e,g=document.getElementById(y);g&&g.setAttribute("onclick","addMedicineField('"+e+"',"+d+")")}function editStatusButton(e){editToSaveButton("save-patient-status-button","patient-status-button","edit-patient-status-button","submitUpdatedStatus('"+e+"')"),document.getElementById("status").className="input-field"}function editTherapyButtons(e,t){editToSaveButton("save-therapy-button","therapy-buttons","edit-therapy-button","submitUpdatedTherapy('"+e+"')"),addDeleteButton("Elimina","delete-therapy-button","therapy-buttons","save-therapy-button","deleteTherapy('"+e+"')"),document.getElementById("condition").className="input-field",document.getElementById("sessions-number").className="input-field",document.getElementById("sessions-frequency").className="input-field",document.getElementById("sessions-duration").className="input-field";for(let e=0;e<t;e++)document.getElementById("medicine-name-item-"+e).className="input-field",document.getElementById("medicine-dose-item-"+e).className="input-field";const n=document.createElement("input");n.setAttribute("type","button"),n.setAttribute("id","add-medicine-saved"),n.setAttribute("class","button-secondary-s rounded edit-button"),n.setAttribute("value","Aggiungi medicinale"),n.setAttribute("onclick","addMedicineField('saved',"+t+")"),document.getElementById("therapy-section").appendChild(n)}function redirectToPatientDetails(e){window.location.replace("PatientServlet?id="+e)}function addPatient(){var e=document.getElementById("name").value,t=document.getElementById("surname").value,n=document.getElementById("birthdate").value,i=document.getElementById("city").value,a=document.getElementById("tax-code").value,d=document.getElementById("phone-number").value,o=document.getElementById("notes").value;const s={name:e,surname:t,birthDate:n,city:i,taxCode:a,phoneNumber:d,notes:o};if(console.log("Risultato controllo campi: "+validatePatientData(s)),validatePatientData(s)){var r=new XMLHttpRequest;r.open("POST","PatientServlet",!0),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),r.setRequestHeader("Authorization","Basic "),r.setRequestHeader("Accept","application/json");var c="action=createPatientProfile&name="+e+"&surname="+t+"&birthDate="+n+"&city="+i+"&taxCode="+a+"&phoneNumber="+d+"&notes="+o;r.send(c),r.onreadystatechange=function(){if(4===r.readyState&&200===r.status)if(r.getResponseHeader("OPERATION_RESULT")){redirectToPatientDetails(r.getResponseHeader("PATIENT_ID"))}else showAlertDanger(r.getResponseHeader("ERROR_MESSAGE"))}}}function addTherapy(e){const t=document.getElementById("new-condition").value,n=document.getElementById("new-sessions-frequency").value,i=document.getElementById("new-sessions-duration").value,a=document.getElementById("new-sessions-number").value,d=document.getElementById("medicines-number").innerHTML;let o=[];for(let e=0;e<d;e++){var s={id:"",dose:""};s.id=document.getElementById("medicine-name-item-"+e).value,s.dose=document.getElementById("medicine-dose-item-"+e).value,o[e]=s,console.log("Aggiunto medicinale "+o[e].id+" - "+o[e].dose)}if(validateTherapyData({condition:t,sessions:a,frequency:n,duration:i,medicinesNumber:d,medicines:o})){var r="action=completePatientProfile&id="+e+"&condition="+t+"&frequency="+n+"&duration="+i+"&sessions="+a+"&medicinesNumber="+d;for(let e=0;e<d;e++)r+="&medicineId"+e+"="+o[e].id,r+="&medicineDose"+e+"="+o[e].dose;sendTherapyData(r)}}function sendTherapyData(e){var t=new XMLHttpRequest;t.open("POST","PatientServlet",!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),t.setRequestHeader("Authorization","Basic "),t.setRequestHeader("Accept","application/json"),t.send(e),t.onreadystatechange=function(){if(4===t.readyState&&200===t.status)if(t.getResponseHeader("OPERATION_RESULT")){redirectToPatientDetails(t.getResponseHeader("PATIENT_ID"))}else showAlertDanger(t.getResponseHeader("ERROR_MESSAGE"))}}function submitUpdatedTherapy(e){const t=document.getElementById("condition").value,n=document.getElementById("sessions-frequency").value,i=document.getElementById("sessions-duration").value,a=document.getElementById("sessions-number").value,d=document.getElementById("medicines-number").innerHTML;let o=[];for(let e=0;e<d;e++){var s={id:"",dose:""};s.id=document.getElementById("medicine-name-item-"+e).value,s.dose=document.getElementById("medicine-dose-item-"+e).value,o[e]=s,console.log("Modificato medicinale "+o[e].id+" - "+o[e].dose)}const r={condition:t,sessions:a,frequency:n,duration:i,medicinesNumber:d,medicines:o};if(console.log("Medicines: "+o[0].id+" "+o[0].dose),validateTherapyData(r)){var c="action=completePatientProfile&id="+e+"&condition="+t+"&frequency="+n+"&duration="+i+"&sessions="+a+"&medicinesNumber="+d;for(let e=0;e<d;e++)c+="&medicineId"+e+"="+o[e].id,c+="&medicineDose"+e+"="+o[e].dose;sendTherapyData(c)}}function submitUpdatedStatus(e){const t=document.getElementById("status").value;console.log(t);const n=document.getElementById("therapy").innerHTML;console.log(n),console.log(e);var i=!0;if(n||(i=!1),i){var a=new XMLHttpRequest;a.open("POST","PatientServlet",!0),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),a.setRequestHeader("Authorization","Basic "),a.setRequestHeader("Accept","application/json");const n="action=editPatientStatus&id="+e+"&status="+t;a.send(n),a.onreadystatechange=function(){4===a.readyState&&200===a.status&&(a.getResponseHeader("OPERATION_RESULT")?redirectToPatientDetails(e):showAlertDanger(a.getResponseHeader("ERROR_MESSAGE")))}}}function startLoading(){document.body.style.cursor="wait",document.body.style.pointerEvents="none";var e=document.getElementById("planner-content");e&&(e.style.transition="opacity 0.2s ease-out",e.style.opacity="0.5")}function stopLoading(){document.body.style.cursor="default",document.body.style.pointerEvents="auto";var e=document.getElementById("planner-content");e&&(e.style.opacity="1")}function addAppointments(){var e=$('input[name="patient-id"]:checked');if(e.length>0){startLoading();var t=new XMLHttpRequest;t.open("POST","PlannerServlet",!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),t.setRequestHeader("Authorization","Basic "),t.setRequestHeader("Accept","application/json");var n="action=addAppointments&patientsNumber="+e.length;for(let t=0;t<e.length;t++)n+="&patient"+t+"="+e[t].value;t.send(n),t.onreadystatechange=function(){4===t.readyState&&(200===t.status?t.getResponseHeader("OPERATION_RESULT")?redirectToPlanner():(stopLoading(),showAlertDanger("Creazione nuova agenda fallita.")):(stopLoading(),showAlertDanger("Errore di comunicazione con il server.")))}}else showAlertWarning("Seleziona almeno un paziente")}function redirectToPlanner(e,t){startLoading(),null==e?window.location.replace("PlannerServlet"):window.location.replace("PlannerServlet?id="+encodeURIComponent(e)+"&buttonPressed="+encodeURIComponent(t))}function getCheckedBoxes(e){const t=document.getElementsByName(e);var n=[];for(let e=0;e<t.length;e++)t[e].checked&&n.push(t[e]);return n.length>0?n:null}function expandSearchFilters(){document.getElementById("search-filters").className="",document.getElementById("search-filters-button").setAttribute("value","Riduci filtri"),document.getElementById("search-filters-button").onclick=reduceSearchFilters}function reduceSearchFilters(){document.getElementById("search-filters").className="hidden",document.getElementById("search-filters-button").setAttribute("value","Espandi filtri"),document.getElementById("search-filters-button").onclick=expandSearchFilters}function editUserCredentials(e){editToSaveButton("save-user-credentials-button","user-credentials-button","edit-user-credentials-button","submitUpdatedCredentials('"+e+" ')"),document.getElementById("username").className="input-field",document.getElementById("password").className="input-field"}document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll(".btn-change-planner, .nav-link-planner").forEach((e=>{e.addEventListener("click",(function(){startLoading()}))}))}));